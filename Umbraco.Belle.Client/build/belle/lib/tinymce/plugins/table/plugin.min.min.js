(function(e,t){"use strict";function n(e,t){for(var n,r=[],i=0;e.length>i;++i){if(n=u[e[i]]||s(e[i]),!n)throw"module definition dependecy not found: "+e[i];r.push(n)}t.apply(null,r)}function r(e,r,i){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(r===t)throw"invalid module definition, dependencies must be specified";if(i===t)throw"invalid module definition, definition function must be specified";n(r,function(){u[e]=i.apply(null,arguments)})}function i(e){return!!u[e]}function s(t){for(var n=e,r=t.split(/[.\/]/),i=0;r.length>i;++i){if(!n[r[i]])return;n=n[r[i]]}return n}function o(n){for(var r=0;n.length>r;r++){for(var i=e,s=n[r],o=s.split(/[.\/]/),a=0;o.length-1>a;++a)i[o[a]]===t&&(i[o[a]]={}),i=i[o[a]];i[o[o.length-1]]=u[s]}}var u={},a="tinymce/tableplugin/TableGrid",f="tinymce/util/Tools",l="tinymce/Env",c="tinymce/tableplugin/Quirks",h="tinymce/util/VK",p="tinymce/tableplugin/CellSelection",d="tinymce/dom/TreeWalker",v="tinymce/tableplugin/Plugin",m="tinymce/PluginManager";r(a,[f,l],function(e,n){function r(e,t){return parseInt(e.getAttribute(t)||1,10)}var i=e.each;return function(s,o){function u(){var e=0;O=[],i(["thead","tbody","tfoot"],function(t){var n=P.select("> "+t+" tr",o);i(n,function(n,s){s+=e,i(P.select("> td, > th",n),function(e,n){var i,o,u,a;if(O[s])for(;O[s][n];)n++;for(u=r(e,"rowspan"),a=r(e,"colspan"),o=s;s+u>o;o++)for(O[o]||(O[o]=[]),i=n;n+a>i;i++)O[o][i]={part:t,real:o==s&&i==n,elm:e,rowspan:u,colspan:a}})}),e+=n.length})}function a(e,t){return e=e.cloneNode(t),e.removeAttribute("id"),e}function f(e,n){var r;return r=O[n],r?r[e]:t}function l(e,t,n){e&&(n=parseInt(n,10),1===n?e.removeAttribute(t,1):e.setAttribute(t,n,1))}function c(e){return e&&(P.hasClass(e.elm,"mce-item-selected")||e==D)}function h(){var e=[];return i(o.rows,function(n){i(n.cells,function(r){return P.hasClass(r,"mce-item-selected")||r==D.elm?(e.push(n),!1):t})}),e}function p(){var e=P.createRng();e.setStartAfter(o),e.setEndAfter(o),s.setRng(e),P.remove(o)}function d(r){var s;return e.walk(r,function(e){var o;return 3==e.nodeType?(i(P.getParents(e.parentNode,null,r).reverse(),function(e){e=a(e,!1),s?o&&o.appendChild(e):s=o=e,o=e}),o&&(o.innerHTML=n.ie?"&nbsp;":'<br data-mce-bogus="1" />'),!1):t},"childNodes"),r=a(r,!1),l(r,"rowSpan",1),l(r,"colSpan",1),s?r.appendChild(s):n.ie||(r.innerHTML='<br data-mce-bogus="1" />'),r}function v(){var e=P.createRng(),n;return i(P.select("tr",o),function(e){0===e.cells.length&&P.remove(e)}),0===P.select("tr",o).length?(e.setStartAfter(o),e.setEndAfter(o),s.setRng(e),P.remove(o),t):(i(P.select("thead,tbody,tfoot",o),function(e){0===e.rows.length&&P.remove(e)}),u(),n=O[Math.min(O.length-1,M.y)],n&&(s.select(n[Math.min(n.length-1,M.x)].elm,!0),s.collapse(!0)),t)}function m(e,t,n,r){var i,s,o,u,a;for(i=O[t][e].elm.parentNode,o=1;n>=o;o++)if(i=P.getNext(i,"tr")){for(s=e;s>=0;s--)if(a=O[t+o][s].elm,a.parentNode==i){for(u=1;r>=u;u++)P.insertAfter(d(a),a);break}if(-1==s)for(u=1;r>=u;u++)i.insertBefore(d(i.cells[0]),i.cells[0])}}function g(){i(O,function(e,t){i(e,function(e,n){var i,s,o;if(c(e)&&(e=e.elm,i=r(e,"colspan"),s=r(e,"rowspan"),i>1||s>1)){for(l(e,"rowSpan",1),l(e,"colSpan",1),o=0;i-1>o;o++)P.insertAfter(d(e),e);m(n,t,s-1,i)}})})}function y(t,n,r){var s,o,a,h,p,d,m,y,b,w,E;if(t?(s=C(t),o=s.x,a=s.y,h=o+(n-1),p=a+(r-1)):(M=_=null,i(O,function(e,t){i(e,function(e,n){c(e)&&(M||(M={x:n,y:t}),_={x:n,y:t})})}),o=M.x,a=M.y,h=_.x,p=_.y),y=f(o,a),b=f(h,p),y&&b&&y.part==b.part){for(g(),u(),y=f(o,a).elm,l(y,"colSpan",h-o+1),l(y,"rowSpan",p-a+1),m=a;p>=m;m++)for(d=o;h>=d;d++)O[m]&&O[m][d]&&(t=O[m][d].elm,t!=y&&(w=e.grep(t.childNodes),i(w,function(e){y.appendChild(e)}),w.length&&(w=e.grep(y.childNodes),E=0,i(w,function(e){"BR"==e.nodeName&&P.getAttrib(e,"data-mce-bogus")&&E++<w.length-1&&y.removeChild(e)})),P.remove(t)));v()}}function b(e){var n,s,o,u,f,h,p,v,m;for(i(O,function(r,s){return i(r,function(r){return c(r)&&(r=r.elm,f=r.parentNode,h=a(f,!1),n=s,e)?!1:t}),e?!n:t}),u=0;O[0].length>u;u++)if(O[n][u]&&(s=O[n][u].elm,s!=o)){if(e){if(n>0&&O[n-1][u]&&(v=O[n-1][u].elm,m=r(v,"rowSpan"),m>1)){l(v,"rowSpan",m+1);continue}}else if(m=r(s,"rowspan"),m>1){l(s,"rowSpan",m+1);continue}p=d(s),l(p,"colSpan",s.colSpan),h.appendChild(p),o=s}h.hasChildNodes()&&(e?f.parentNode.insertBefore(h,f):P.insertAfter(h,f))}function w(e){var n,s;i(O,function(r){return i(r,function(r,i){return c(r)&&(n=i,e)?!1:t}),e?!n:t}),i(O,function(t,i){var o,u,a;t[n]&&(o=t[n].elm,o!=s&&(a=r(o,"colspan"),u=r(o,"rowspan"),1==a?e?(o.parentNode.insertBefore(d(o),o),m(n,i,u-1,a)):(P.insertAfter(d(o),o),m(n,i,u-1,a)):l(o,"colSpan",o.colSpan+1),s=o))})}function E(){var t=[];i(O,function(n){i(n,function(n,s){c(n)&&-1===e.inArray(t,s)&&(i(O,function(e){var t=e[s].elm,n;n=r(t,"colSpan"),n>1?l(t,"colSpan",n-1):P.remove(t)}),t.push(s))})}),v()}function S(){function e(e){var t,n,s;t=P.getNext(e,"tr"),i(e.cells,function(e){var t=r(e,"rowSpan");t>1&&(l(e,"rowSpan",t-1),n=C(e),m(n.x,n.y,1,1))}),n=C(e.cells[0]),i(O[n.y],function(e){var t;e=e.elm,e!=s&&(t=r(e,"rowSpan"),1>=t?P.remove(e):l(e,"rowSpan",t-1),s=e)})}var t;t=h(),i(t.reverse(),function(t){e(t)}),v()}function x(){var e=h();return P.remove(e),v(),e}function T(){var e=h();return i(e,function(t,n){e[n]=a(t,!0)}),e}function N(e,n){var r=h(),s=r[n?0:r.length-1],o=s.cells.length;e&&(i(O,function(e){var n;return o=0,i(e,function(e){e.real&&(o+=e.colspan),e.elm.parentNode==s&&(n=1)}),n?!1:t}),n||e.reverse(),i(e,function(e){var t,r=e.cells.length,i;for(t=0;r>t;t++)i=e.cells[t],l(i,"colSpan",1),l(i,"rowSpan",1);for(t=r;o>t;t++)e.appendChild(d(e.cells[r-1]));for(t=o;r>t;t++)P.remove(e.cells[t]);n?s.parentNode.insertBefore(e,s):P.insertAfter(e,s)}),P.removeClass(P.select("td.mce-item-selected,th.mce-item-selected"),"mce-item-selected"))}function C(e){var n;return i(O,function(r,s){return i(r,function(r,i){return r.elm==e?(n={x:i,y:s},!1):t}),!n}),n}function k(e){M=C(e)}function L(){var e,t;return e=t=0,i(O,function(n,r){i(n,function(n,i){var s,o;c(n)&&(n=O[r][i],i>e&&(e=i),r>t&&(t=r),n.real&&(s=n.colspan-1,o=n.rowspan-1,s&&i+s>e&&(e=i+s),o&&r+o>t&&(t=r+o)))})}),{x:e,y:t}}function A(e){var t,n,r,i,s,o,u,a,f,l;if(_=C(e),M&&_){for(t=Math.min(M.x,_.x),n=Math.min(M.y,_.y),r=Math.max(M.x,_.x),i=Math.max(M.y,_.y),s=r,o=i,l=n;o>=l;l++)e=O[l][t],e.real||t>t-(e.colspan-1)&&(t-=e.colspan-1);for(f=t;s>=f;f++)e=O[n][f],e.real||n>n-(e.rowspan-1)&&(n-=e.rowspan-1);for(l=n;i>=l;l++)for(f=t;r>=f;f++)e=O[l][f],e.real&&(u=e.colspan-1,a=e.rowspan-1,u&&f+u>s&&(s=f+u),a&&l+a>o&&(o=l+a));for(P.removeClass(P.select("td.mce-item-selected,th.mce-item-selected"),"mce-item-selected"),l=n;o>=l;l++)for(f=t;s>=f;f++)O[l][f]&&P.addClass(O[l][f].elm,"mce-item-selected")}}var O,M,_,D,P=s.dom;o=o||P.getParent(s.getStart(),"table"),u(),D=P.getParent(s.getStart(),"th,td"),D&&(M=C(D),_=L(),D=f(M.x,M.y)),e.extend(this,{deleteTable:p,split:g,merge:y,insertRow:b,insertCol:w,deleteCols:E,deleteRows:S,cutRows:x,copyRows:T,pasteRows:N,getPos:C,setStartCell:k,setEndCell:A})}}),r(c,[h,l,f],function(e,n,r){function i(e,t){return parseInt(e.getAttribute(t)||1,10)}var s=r.each;return function(r){function o(){function n(n){function o(e,t){var i=e?"previousSibling":"nextSibling",s=r.dom.getParent(t,"tr"),o=s[i];if(o)return g(r,t,o,e),n.preventDefault(),!0;var a=r.dom.getParent(s,"table"),c=s.parentNode,h=c.nodeName.toLowerCase();if("tbody"===h||h===(e?"tfoot":"thead")){var p=u(e,a,c,"tbody");if(null!==p)return f(e,p,t)}return l(e,s,i,a)}function u(e,t,n,i){var s=r.dom.select(">"+i,t),o=s.indexOf(n);if(e&&0===o||!e&&o===s.length-1)return a(e,t);if(-1===o){var u="thead"===n.tagName.toLowerCase()?0:s.length-1;return s[u]}return s[o+(e?-1:1)]}function a(e,t){var n=e?"thead":"tfoot",i=r.dom.select(">"+n,t);return 0!==i.length?i[0]:null}function f(e,t,i){var s=c(t,e);return s&&g(r,i,s,e),n.preventDefault(),!0}function l(e,t,i,s){var u=s[i];if(u)return h(u),!0;var a=r.dom.getParent(s,"td,th");if(a)return o(e,a,n);var f=c(t,!e);return h(f),n.preventDefault(),!1}function c(e,t){var n=e&&e[t?"lastChild":"firstChild"];return n&&"BR"===n.nodeName?r.dom.getParent(n,"td,th"):n}function h(e){r.selection.setCursorLocation(e,0)}function p(){return w==e.UP||w==e.DOWN}function d(e){var t=e.selection.getNode(),n=e.dom.getParent(t,"tr");return null!==n}function v(e){for(var t=0,n=e;n.previousSibling;)n=n.previousSibling,t+=i(n,"colspan");return t}function m(e,n){var r=0,o=0;return s(e.children,function(e,s){return r+=i(e,"colspan"),o=s,r>n?!1:t}),o}function g(e,t,n,i){var s=v(r.dom.getParent(t,"td,th")),o=m(n,s),u=n.childNodes[o],a=c(u,i);h(a||u)}function y(e){var t=r.selection.getNode(),n=r.dom.getParent(t,"td,th"),i=r.dom.getParent(e,"td,th");return n&&n!==i&&b(n,i)}function b(e,t){return r.dom.getParent(e,"TABLE")===r.dom.getParent(t,"TABLE")}var w=n.keyCode;if(p()&&d(r)){var E=r.selection.getNode();setTimeout(function(){y(E)&&o(!n.shiftKey&&w===e.UP,E,n)},0)}}r.on("KeyDown",function(e){n(e)})}function u(){function e(e,t){var n=t.ownerDocument,r=n.createRange(),i;return r.setStartBefore(t),r.setEnd(e.endContainer,e.endOffset),i=n.createElement("body"),i.appendChild(r.cloneContents()),0===i.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length}r.on("KeyDown",function(t){var n,i,s=r.dom;(37==t.keyCode||38==t.keyCode)&&(n=r.selection.getRng(),i=s.getParent(n.startContainer,"table"),i&&r.getBody().firstChild==i&&e(n,i)&&(n=s.createRng(),n.setStartBefore(i),n.setEndBefore(i),r.selection.setRng(n),t.preventDefault()))})}function a(){r.on("KeyDown SetContent VisualAid",function(){var e;for(e=r.getBody().lastChild;e;e=e.previousSibling)if(3==e.nodeType){if(e.nodeValue.length>0)break}else if(1==e.nodeType&&!e.getAttribute("data-mce-bogus"))break;e&&"TABLE"==e.nodeName&&(r.settings.forced_root_block?r.dom.add(r.getBody(),r.settings.forced_root_block,null,n.ie?"&nbsp;":'<br data-mce-bogus="1" />'):r.dom.add(r.getBody(),"br",{"data-mce-bogus":"1"}))}),r.on("PreProcess",function(e){var t=e.node.lastChild;t&&("BR"==t.nodeName||1==t.childNodes.length&&("BR"==t.firstChild.nodeName||" "==t.firstChild.nodeValue))&&t.previousSibling&&"TABLE"==t.previousSibling.nodeName&&r.dom.remove(t)})}function f(){function e(e,t,n,r){var i=3,s=e.dom.getParent(t.startContainer,"TABLE"),o,u,a;return s&&(o=s.parentNode),u=t.startContainer.nodeType==i&&0===t.startOffset&&0===t.endOffset&&r&&("TR"==n.nodeName||n==o),a=("TD"==n.nodeName||"TH"==n.nodeName)&&!r,u||a}function t(){var t=r.selection.getRng(),n=r.selection.getNode(),i=r.dom.getParent(t.startContainer,"TD,TH");if(e(r,t,n,i)){i||(i=n);for(var s=i.lastChild;s.lastChild;)s=s.lastChild;t.setEnd(s,s.nodeValue.length),r.selection.setRng(t)}}r.on("KeyDown",function(){t()}),r.on("MouseDown",function(e){2!=e.button&&t()})}n.webkit&&(o(),f()),n.gecko&&(u(),a())}}),r(p,[a,d,f],function(e,n,r){return function(i){function s(){i.getBody().style.webkitUserSelect="",l&&(i.dom.removeClass(i.dom.select("td.mce-item-selected,th.mce-item-selected"),"mce-item-selected"),l=!1)}var o=i.dom,u,a,f,l=!0;return i.on("MouseDown",function(e){2!=e.button&&(s(),a=o.getParent(e.target,"td,th"),f=o.getParent(a,"table"))}),o.bind(i.getDoc(),"mouseover",function(t){var n,r,s=t.target;if(a&&(u||s!=a)&&("TD"==s.nodeName||"TH"==s.nodeName)){r=o.getParent(s,"table"),r==f&&(u||(u=new e(i.selection,r),u.setStartCell(a),i.getBody().style.webkitUserSelect="none"),u.setEndCell(s),l=!0),n=i.selection.getSel();try{n.removeAllRanges?n.removeAllRanges():n.empty()}catch(c){}t.preventDefault()}}),i.on("MouseUp",function(){function e(e,i){var o=new n(e,e);do{if(3==e.nodeType&&0!==r.trim(e.nodeValue).length)return i?s.setStart(e,0):s.setEnd(e,e.nodeValue.length),t;if("BR"==e.nodeName)return i?s.setStartBefore(e):s.setEndBefore(e),t}while(e=i?o.next():o.prev())}var s,l=i.selection,c,h,p,d,v;if(a){if(u&&(i.getBody().style.webkitUserSelect=""),c=o.select("td.mce-item-selected,th.mce-item-selected"),c.length>0){s=o.createRng(),p=c[0],v=c[c.length-1],s.setStartBefore(p),s.setEndAfter(p),e(p,1),h=new n(p,o.getParent(c[0],"table"));do if("TD"==p.nodeName||"TH"==p.nodeName){if(!o.hasClass(p,"mce-item-selected"))break;d=p}while(p=h.next());e(d),l.setRng(s)}i.nodeChanged(),a=u=f=null}}),i.on("KeyUp",function(){s()}),{clear:s}}}),r(v,[a,c,p,f,d,l,m],function(e,n,r,i,s,o,u){function a(i){function s(e){return e?e.replace(/px$/,""):""}function u(e){return/^[0-9]+$/.test(e)&&(e+="px"),e}function a(){var e=i.dom,t,n;t=i.dom.getParent(i.selection.getStart(),"table"),n={width:s(e.getStyle(t,"width")||e.getAttrib(t,"width")),height:s(e.getStyle(t,"height")||e.getAttrib(t,"height")),cellspacing:e.getAttrib(t,"cellspacing"),cellpadding:e.getAttrib(t,"cellpadding"),border:e.getAttrib(t,"border"),caption:!!e.select("caption",t)[0]},f("left center right".split(" "),function(e){i.formatter.matchNode(t,"align"+e)&&(n.align=e)}),i.windowManager.open({title:"Table properties",items:{type:"form",layout:"grid",columns:2,data:n,defaults:{type:"textbox",maxWidth:50},items:[{label:"Cols",name:"cols",disabled:!0},{label:"Rows",name:"rows",disabled:!0},{label:"Width",name:"width"},{label:"Height",name:"height"},{label:"Cell spacing",name:"cellspacing"},{label:"Cell padding",name:"cellpadding"},{label:"Border",name:"border"},{label:"Caption",name:"caption",type:"checkbox"},{label:"Alignment",minWidth:90,name:"align",type:"listbox",text:"None",maxWidth:null,values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]}]},onsubmit:function(){var n=this.toJSON(),r;i.undoManager.transact(function(){i.dom.setAttribs(t,{cellspacing:n.cellspacing,cellpadding:n.cellpadding,border:n.border}),i.dom.setStyles(t,{width:u(n.width),height:u(n.height)}),r=e.select("caption",t)[0],r&&!n.caption&&e.remove(r),!r&&n.caption&&(r=e.create("caption"),o.ie||(r.innerHTML='<br data-mce-bogus="1"/>'),t.insertBefore(r,t.firstChild)),n.align?i.formatter.apply("align"+n.align,{},t):f("left center right".split(" "),function(e){i.formatter.remove("align"+e,{},t)}),i.focus(),i.addVisual()})}})}function l(e,t){i.windowManager.open({title:"Merge cells",body:[{label:"Cols",name:"cols",type:"textbox",size:10},{label:"Rows",name:"rows",type:"textbox",size:10}],onsubmit:function(){var n=this.toJSON();i.undoManager.transact(function(){e.merge(t,n.cols,n.rows)})}})}function c(){var e=i.dom,t,n,r=[];r=i.dom.select("td.mce-item-selected,th.mce-item-selected"),t=i.dom.getParent(i.selection.getStart(),"td,th"),!r.length&&t&&r.push(t),t=t||r[0],n={width:s(e.getStyle(t,"width")||e.getAttrib(t,"width")),height:s(e.getStyle(t,"height")||e.getAttrib(t,"height")),scope:e.getAttrib(t,"scope")},n.type=t.nodeName.toLowerCase(),f("left center right".split(" "),function(e){i.formatter.matchNode(t,"align"+e)&&(n.align=e)}),i.windowManager.open({title:"Cell properties",items:{type:"form",data:n,layout:"grid",columns:2,defaults:{type:"textbox",maxWidth:50},items:[{label:"Width",name:"width"},{label:"Height",name:"height"},{label:"Cell type",name:"type",type:"listbox",text:"None",minWidth:90,maxWidth:null,menu:[{text:"Cell",value:"td"},{text:"Header cell",value:"th"}]},{label:"Scope",name:"scope",type:"listbox",text:"None",minWidth:90,maxWidth:null,menu:[{text:"None",value:""},{text:"Row",value:"row"},{text:"Column",value:"col"},{text:"Row group",value:"rowgroup"},{text:"Column group",value:"colgroup"}]},{label:"Alignment",name:"align",type:"listbox",text:"None",minWidth:90,maxWidth:null,values:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]}]},onsubmit:function(){var t=this.toJSON();i.undoManager.transact(function(){f(r,function(n){i.dom.setAttrib(n,"scope",t.scope),i.dom.setStyles(n,{width:u(t.width),height:u(t.height)}),t.type&&n.nodeName.toLowerCase()!=t.type&&(n=e.rename(n,t.type)),t.align?i.formatter.apply("align"+t.align,{},n):f("left center right".split(" "),function(e){i.formatter.remove("align"+e,{},n)})}),i.focus()})}})}function h(){var e=i.dom,n,r,o,a,l=[];n=i.dom.getParent(i.selection.getStart(),"table"),r=i.dom.getParent(i.selection.getStart(),"td,th"),f(n.rows,function(n){f(n.cells,function(i){return e.hasClass(i,"mce-item-selected")||i==r?(l.push(n),!1):t})}),o=l[0],a={height:s(e.getStyle(o,"height")||e.getAttrib(o,"height")),scope:e.getAttrib(o,"scope")},a.type=o.parentNode.nodeName.toLowerCase(),f("left center right".split(" "),function(e){i.formatter.matchNode(o,"align"+e)&&(a.align=e)}),i.windowManager.open({title:"Row properties",items:{type:"form",data:a,columns:2,defaults:{type:"textbox"},items:[{type:"listbox",name:"type",label:"Row type",text:"None",maxWidth:null,menu:[{text:"Header",value:"thead"},{text:"Body",value:"tbody"},{text:"Footer",value:"tfoot"}]},{type:"listbox",name:"align",label:"Alignment",text:"None",maxWidth:null,menu:[{text:"None",value:""},{text:"Left",value:"left"},{text:"Center",value:"center"},{text:"Right",value:"right"}]},{label:"Height",name:"height"}]},onsubmit:function(){var t=this.toJSON(),n,r,s;i.undoManager.transact(function(){f(l,function(o){i.dom.setAttrib(o,"scope",t.scope),i.dom.setStyles(o,{height:u(t.height)}),t.type!=o.parentNode.nodeName.toLowerCase()&&(n=e.getParent(o,"table"),r=o.parentNode,s=e.select(n,t.type)[0],s||(s=e.create(t.type),n.firstChild?n.insertBefore(s,n.firstChild):n.appendChild(s)),s.insertBefore(o,s.firstChild),r.hasChildNodes()||e.remove(r)),t.align?i.formatter.apply("align"+t.align,{},o):f("left center right".split(" "),function(e){i.formatter.remove("align"+e,{},o)})}),i.focus()})}})}function p(e){return function(){i.execCommand(e)}}function d(e,t){var n,r,s;for(s="<table><tbody>",n=0;t>n;n++){for(s+="<tr>",r=0;e>r;r++)s+="<td>"+(o.ie?" ":"<br>")+"</td>";s+="</tr>"}s+="</tbody></table>",i.insertContent(s)}function v(e,t){function n(){e.disabled(!i.dom.getParent(i.selection.getStart(),t)),i.selection.selectorChanged(t,function(t){e.disabled(!t)})}i.initialized?n():i.on("init",n)}function m(){v(this,"table")}function g(){v(this,"td,th")}function y(){var e="";e='<table role="presentation" class="mce-grid mce-grid-border">';for(var t=0;10>t;t++){e+="<tr>";for(var n=0;10>n;n++)e+='<td><a href="#" data-mce-index="'+n+","+t+'"></a></td>';e+="</tr>"}return e+="</table>",e+='<div class="mce-text-center">0 x 0</div>'}var b,w,E=this;f([["table","Insert/edit table","mceInsertTable",m],["delete_table","Delete table","mceTableDelete",m],["delete_col","Delete column","mceTableDeleteCol",g],["delete_row","Delete row","mceTableDeleteRow",g],["col_after","Insert column after","mceTableInsertColAfter",g],["col_before","Insert column before","mceTableInsertColBefore",g],["row_after","Insert row after","mceTableInsertRowAfter",g],["row_before","Insert row before","mceTableInsertRowBefore",g],["row_props","Row properties","mceTableRowProps",g],["cell_props","Cell properties","mceTableCellProps",g],["split_cells","Split cells","mceTableSplitCells",g],["merge_cells","Merge cells","mceTableMergeCells",g]],function(e){i.addButton(e[0],{title:e[1],cmd:e[2],onPostRender:e[3]})}),i.addMenuItem("inserttable",{text:"Insert table",icon:"table",context:"table",onhide:function(){i.dom.removeClass(this.menu.items()[0].getEl().getElementsByTagName("a"),"mce-active")},menu:[{type:"container",html:y(),onmousemove:function(e){var t=e.target;if("A"==t.nodeName){var n=i.dom.getParent(t,"table"),r=t.getAttribute("data-mce-index");if(r!=this.lastPos){r=r.split(","),r[0]=parseInt(r[0],10),r[1]=parseInt(r[1],10);for(var s=0;10>s;s++)for(var o=0;10>o;o++)i.dom.toggleClass(n.rows[s].childNodes[o].firstChild,"mce-active",r[0]>=o&&r[1]>=s);n.nextSibling.innerHTML=r[0]+1+" x "+(r[1]+1),this.lastPos=r}}},onclick:function(e){"A"==e.target.nodeName&&this.lastPos&&(e.preventDefault(),d(this.lastPos[0]+1,this.lastPos[1]+1),this.parent().cancel())}}]}),i.addMenuItem("tableprops",{text:"Table properties",context:"table",onPostRender:m,onclick:a}),i.addMenuItem("deletetable",{text:"Delete table",context:"table",onPostRender:m,cmd:"mceTableDelete"}),i.addMenuItem("cell",{separator:"before",text:"Cell",context:"table",menu:[{text:"Cell properties",onclick:p("mceTableCellProps"),onPostRender:g},{text:"Merge cells",onclick:p("mceTableMergeCells"),onPostRender:g},{text:"Split cell",onclick:p("mceTableSplitCells"),onPostRender:g}]}),i.addMenuItem("row",{text:"Row",context:"table",menu:[{text:"Insert row before",onclick:p("mceTableInsertRowBefore"),onPostRender:g},{text:"Insert row after",onclick:p("mceTableInsertRowAfter"),onPostRender:g},{text:"Delete row",onclick:p("mceTableDeleteRow"),onPostRender:g},{text:"Row properties",onclick:p("mceTableRowProps"),onPostRender:g},{text:"-"},{text:"Cut row",onclick:p("mceTableCutRow"),onPostRender:g},{text:"Copy row",onclick:p("mceTableCopyRow"),onPostRender:g},{text:"Paste row before",onclick:p("mceTablePasteRowBefore"),onPostRender:g},{text:"Paste row after",onclick:p("mceTablePasteRowAfter"),onPostRender:g}]}),i.addMenuItem("column",{text:"Column",context:"table",menu:[{text:"Insert column before",onclick:p("mceTableInsertColBefore"),onPostRender:g},{text:"Insert column after",onclick:p("mceTableInsertColAfter"),onPostRender:g},{text:"Delete column",onclick:p("mceTableDeleteCol"),onPostRender:g}]}),o.isIE||i.on("click",function(e){e=e.target,"TABLE"===e.nodeName&&(i.selection.select(e),i.nodeChanged())}),E.quirks=new n(i),i.on("Init",function(){b=i.windowManager,E.cellSelection=new r(i)}),f({mceTableSplitCells:function(e){e.split()},mceTableMergeCells:function(e){var t,n,r;r=i.dom.getParent(i.selection.getStart(),"th,td"),r&&(t=r.rowSpan,n=r.colSpan),i.dom.select("td.mce-item-selected,th.mce-item-selected").length?e.merge():l(e,r)},mceTableInsertRowBefore:function(e){e.insertRow(!0)},mceTableInsertRowAfter:function(e){e.insertRow()},mceTableInsertColBefore:function(e){e.insertCol(!0)},mceTableInsertColAfter:function(e){e.insertCol()},mceTableDeleteCol:function(e){e.deleteCols()},mceTableDeleteRow:function(e){e.deleteRows()},mceTableCutRow:function(e){w=e.cutRows()},mceTableCopyRow:function(e){w=e.copyRows()},mceTablePasteRowBefore:function(e){e.pasteRows(w,!0)},mceTablePasteRowAfter:function(e){e.pasteRows(w)},mceTableDelete:function(e){e.deleteTable()}},function(t,n){i.addCommand(n,function(){var n=new e(i.selection);n&&(t(n),i.execCommand("mceRepaint"),E.cellSelection.clear())})}),f({mceInsertTable:function(){a()},mceTableRowProps:h,mceTableCellProps:c},function(e,t){i.addCommand(t,function(t,n){e(n)})})}var f=i.each;u.add("table",a)}),o([a,c,p,v])})(this);