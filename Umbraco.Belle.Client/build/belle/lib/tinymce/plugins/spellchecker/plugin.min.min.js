(function(e,t){"use strict";function n(e,t){for(var n,r=[],i=0;e.length>i;++i){if(n=u[e[i]]||s(e[i]),!n)throw"module definition dependecy not found: "+e[i];r.push(n)}t.apply(null,r)}function r(e,r,i){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(r===t)throw"invalid module definition, dependencies must be specified";if(i===t)throw"invalid module definition, definition function must be specified";n(r,function(){u[e]=i.apply(null,arguments)})}function i(e){return!!u[e]}function s(t){for(var n=e,r=t.split(/[.\/]/),i=0;r.length>i;++i){if(!n[r[i]])return;n=n[r[i]]}return n}function o(n){for(var r=0;n.length>r;r++){for(var i=e,s=n[r],o=s.split(/[.\/]/),a=0;o.length-1>a;++a)i[o[a]]===t&&(i[o[a]]={}),i=i[o[a]];i[o[o.length-1]]=u[s]}}var u={},a="tinymce/spellcheckerplugin/DomTextMatcher",f="tinymce/spellcheckerplugin/Plugin",l="tinymce/PluginManager",c="tinymce/util/Tools",h="tinymce/ui/Menu",p="tinymce/dom/DOMUtils",d="tinymce/util/JSONRequest";r(a,[],function(){return function(e,t,n){function r(e){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var t=e.index;return[t,t+e[0].length,[e[0]]]}function i(e){var t;if(3===e.nodeType)return e.data;if(m[e.nodeName])return"";if(t="",(v[e.nodeName]||g[e.nodeName])&&(t+="\n"),e=e.firstChild)do t+=i(e);while(e=e.nextSibling);return t}function s(e,t,n){var r,i,s,o,u=[],a=0,f=e,l=t.shift(),c=0;e:for(;;){if((v[f.nodeName]||g[f.nodeName])&&a++,3===f.nodeType&&(!i&&f.length+a>=l[1]?(i=f,o=l[1]-a):r&&u.push(f),!r&&f.length+a>l[0]&&(r=f,s=l[0]-a),a+=f.length),r&&i){if(f=n({startNode:r,startNodeIndex:s,endNode:i,endNodeIndex:o,innerNodes:u,match:l[2],matchIndex:c}),a-=i.length-o,r=null,i=null,u=[],l=t.shift(),c++,!l)break}else{if(!m[f.nodeName]&&f.firstChild){f=f.firstChild;continue}if(f.nextSibling){f=f.nextSibling;continue}}for(;;){if(f.nextSibling){f=f.nextSibling;break}if(f.parentNode===e)break e;f=f.parentNode}}}function o(e){var t;if("function"!=typeof e){var n=e.nodeType?e:d.createElement(e);t=function(e,t){var r=n.cloneNode(!1);return r.setAttribute("data-mce-index",t),e&&r.appendChild(d.createTextNode(e)),r}}else t=e;return function r(e){var n,r,i,s=e.startNode,o=e.endNode,u=e.matchIndex;if(s===o){var a=s;i=a.parentNode,e.startNodeIndex>0&&(n=d.createTextNode(a.data.substring(0,e.startNodeIndex)),i.insertBefore(n,a));var f=t(e.match[0],u);return i.insertBefore(f,a),e.endNodeIndex<a.length&&(r=d.createTextNode(a.data.substring(e.endNodeIndex)),i.insertBefore(r,a)),a.parentNode.removeChild(a),f}n=d.createTextNode(s.data.substring(0,e.startNodeIndex)),r=d.createTextNode(o.data.substring(e.endNodeIndex));for(var l=t(s.data.substring(e.startNodeIndex),u),c=[],h=0,p=e.innerNodes.length;p>h;++h){var v=e.innerNodes[h],m=t(v.data,u);v.parentNode.replaceChild(m,v),c.push(m)}var g=t(o.data.substring(0,e.endNodeIndex),u);return i=s.parentNode,i.insertBefore(n,s),i.insertBefore(l,s),i.removeChild(s),i=o.parentNode,i.insertBefore(g,o),i.insertBefore(r,o),i.removeChild(o),g}}function u(e){var t=[];return a(function(n,r){e(n,r)&&t.push(n)}),c=t,this}function a(e){for(var t=0,n=c.length;n>t&&e(c[t],t)!==!1;t++);return this}function f(e){return c.length&&(p=c.length,s(t,c,o(e))),this}var l,c=[],h,p=0,d,v,m,g;if(d=t.ownerDocument,v=n.getBlockElements(),m=n.getWhiteSpaceElements(),g=n.getShortEndedElements(),h=i(t),h&&e.global)for(;l=e.exec(h);)c.push(r(l));return{text:h,count:p,matches:c,each:a,filter:u,mark:f}}}),r(f,[a,l,c,h,p,d],function(e,n,r,i,s,o){n.add("spellchecker",function(n){function u(e){for(var t in e)return!1;return!0}function a(e,t){var o=[],u=v[t];r.each(u,function(e){o.push({text:e,onclick:function(){n.insertContent(e),l()}})}),o.push.apply(o,[{text:"-"},{text:"Ignore",onclick:function(){h(e,t)}},{text:"Ignore all",onclick:function(){h(e,t,!0)}},{text:"Finish",onclick:p}]);var a=new i({items:o,context:"contextmenu",onhide:function(){a.remove()}});a.renderTo(document.body);var f=s.DOM.getPos(n.getContentAreaContainer()),c=n.dom.getPos(e);f.x+=c.x,f.y+=c.y,a.moveTo(f.x,f.y+e.offsetHeight)}function f(){function r(e){return n.setProgressState(!1),u(e)?(n.windowManager.alert("No misspellings found"),t):(v=e,i.filter(function(t){return!!e[t[2][0]]}).mark(n.dom.create("span",{"class":"mce-spellchecker-word","data-mce-bogus":1})),i=null,n.fire("SpellcheckStart"),t)}var i,s=[],a={};return m?(p(),t):(m=!0,i=(new e(/\w+/g,n.getBody(),n.schema)).each(function(e){a[e[2][0]]||(s.push(e[2][0]),a[e[2][0]]=!0)}),n.settings.spellcheck_callback=function(e,t,r){o.sendRPC({url:n.settings.spellchecker_rpc_url,method:e,params:{lang:"en",words:t},success:function(e){r(e)},error:function(e,t){n.windowManager.alert("Error: "+e+"\nData:"+t.responseText),n.setProgressState(!1),i=null}})},n.setProgressState(!0),n.settings.spellcheck_callback("spellcheck",s,r),t)}function l(){n.dom.select("span.mce-spellchecker-word").length||p()}function c(e){var t=e.parentNode;t.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function h(e,t,i){i?r.each(n.dom.select("span.mce-spellchecker-word"),function(e){var n=e.innerText||e.textContent;n==t&&c(e)}):c(e),l()}function p(){var e,t,r;for(m=!1,r=n.getBody(),t=r.getElementsByTagName("span"),e=t.length;e--;)r=t[e],r.getAttribute("data-mce-index")&&c(r);n.fire("SpellcheckEnd")}function d(e){var t,r,i,s=-1,o,u;for(e=""+e,t=n.getBody().getElementsByTagName("span"),r=0;t.length>r&&(i=t[r],"mce-spellchecker-word"!=i.className||(s=i.getAttribute("data-mce-index"),s===e&&(s=e,o||(o=i.firstChild),u=i.firstChild),s===e||!u));r++);var a=n.dom.createRng();return a.setStart(o,0),a.setEnd(u,u.length),n.selection.setRng(a),a}var v,m;n.on("click",function(e){if("mce-spellchecker-word"==e.target.className){e.preventDefault();var t=d(e.target.getAttribute("data-mce-index"));a(e.target,""+t)}}),n.addMenuItem("spellchecker",{text:"Spellcheck",context:"tools",onclick:f,selectable:!0,onPostRender:function(){var e=this;n.on("SpellcheckStart SpellcheckEnd",function(){e.active(m)})}}),n.addButton("spellchecker",{tooltip:"Spellcheck",onclick:f,onPostRender:function(){var e=this;n.on("SpellcheckStart SpellcheckEnd",function(){e.active(m)})}})})}),o([a,f])})(this);